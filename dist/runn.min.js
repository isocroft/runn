!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var r={exports:{}};t(r.exports),e.runn=r.exports.runn}}(this,function(e){"use strict";let t=()=>{if("undefined"==typeof window)return!1;try{if(void 0!==window.WebKitMutationObserver&&"object"!=typeof window.chrome)return!0}catch{}return!1},r=(e=null)=>{if(e&&e instanceof Error)return"stack"in e;let t=Object.getOwnPropertyDescriptor(Error.prototype,"stack");return!("stack"in Error("test message"))&&void 0===t},n=e=>e&&e instanceof Error,a=e=>!e||!(e instanceof Error),s=e=>null!=e&&e instanceof Object&&Boolean("function"==typeof e.then&&("[object Promise]"===Object.prototype.toString.call(e)||"Promise"===e.constructor.name)),i=e=>!s(e);"undefined"==typeof window&&"undefined"!=typeof process&&(process.window=new EventTarget),"cause"in Error("test message",{cause:"[test cause]"})||Object.defineProperty(Error.prototype,"cause",{configurable:!0,enumerable:!1,get(){return this._cause},set(e){this._cause=e}}),-1===Error("test message").toString().toLowerCase().indexOf("cause")&&(Error.prototype.valueOf=function e(){let n=this.stack,a=this.cause,s="",i=0,o=!r(this),c=t(),u=o||c?/((?:global code)?@(?:anonymous|[a-zA-Z0-9-_)(\]\[\.]):\d{1,}:\d{1,}(?=))/m:/(at (?:<anonymous>|[a-zA-Z0-9-_\)\(\]\[\.]):\d{1,}:\d{1,}(?=))/m;for(;a;){++i;let l=Array(i).fill("	").join("");""===s?s+=n.replace(u,"\n\r\r reason: "+(a instanceof Error?a.stack.replace(u,`${l}$1`):JSON.stringify(a))):s+=s.replace(u,"\n\r\r reason: "+(a instanceof Error?a.stack.replace(u,`${l}$1`):JSON.stringify(a))),a=a instanceof Error?a.cause:null}return""!==s&&(this.stack=s),this}),c.$$groupAll=function(...e){var t;return Promise.all(e).then((t=promise.map(e=>i(e)?"_":e.__name),e=>Promise.resolve(e.reduce((e,r,n)=>(e[t[n]]=r,e),{})))).catch(e=>{let t=this.$$sync;null!==t&&"object"==typeof t&&"function"==typeof t.addWaitError&&t.addWaitError(e)})},c.$$dispatchErrorEvent=e=>{let t=new Event("log.promise.error_");t.error=e,t.timestampId=Date.now(),"undefined"==typeof window?"undefined"!=typeof process&&process.window.dispatchEvent(t):window.dispatchEvent(t)};class o{constructor(e,t,r,n,s){let i=t;a(t)&&(i="string"==typeof t?Error(t):Error("Something went wrong: "+JSON.stringify(t))),this._promise=e,this.mainError=i,this._taskFnName=n,this.syncObject=r,this.augumentError=s}_patchErrorObjectAndDispatchToLogger(e){let t=new Event("log.promise.error_");this.mainError.cause=e;let r=this.mainError.valueOf().stack,n=r.indexOf("\n");return this.mainError.stack=this.augumentError.stack.replace(/^Error(?:[^\n]*)\n/,r.substring(0,n)).replace(/\b(?:[\s]*)(at runn \((?:<anonymous>|[a-zA-Z0-9-_\)\(\]\[\.]):\d{1,}:\d{1,}\))(?:.*)/,"cause"in e?"\n		$1":"\n	$1").replace("runn",this._taskFnName).trim()+r.substring(n+1),t.error=this.mainError,t.timestampId=Date.now(),"undefined"==typeof window?"undefined"!=typeof process&&process.window.dispatchEvent(t):window.dispatchEvent(t),this.mainError}_normalizeReturnValuesOrError(e,t,r){if(e instanceof o)return e;if("<no error>"===t){let n=Promise.resolve(e);return n.__name=r,new o(n,this.mainError,this.syncObject,r,this.augumentError)}let s=t;return a(t)&&(s="string"==typeof t?Error(t):Error("Something went wrong: "+JSON.stringify(t))),($promise=Promise.reject(s)).__name=r,new o($promise,this.mainError,this.syncObject,r,this.augumentError)}then(e){return"function"!=typeof e?this._promise.catch(e=>this._patchErrorObjectAndDispatchToLogger(e)):new o(this._promise.then(t=>{let r,n="<no error>";try{r=e.call(null,t)}catch(a){n=a}return s(r)?(r.__name=e.name,new o(r,this.mainError,this.syncObject,e.name,this.augumentError)):this._normalizeReturnValuesOrError(r,n,e.name)},t=>{let r=Promise.reject(t);return r.__name=e.name,new o(r,this.mainError,this.syncObject,e.name,this.augumentError)}),this.mainError,this.syncObject,this._taskFnName,this.augumentError)}die(){return this.then().catch(e=>{let t=this.syncObject;try{throw e}finally{t=null,this._promise=null,this._taskFnName=null,this.augumentError=null}}).then(e=>{if(e instanceof Error)throw e;return e})}end(){let e=this.then().catch(e=>{let t=this.syncObject;return null!==t&&"object"==typeof t&&"function"==typeof t.realeaseFromWait&&(t.addWaitError(e),t.realeaseFromWait(this._taskFnName)),e});return e.__name=this._promise.__name,e}}function c(e=()=>Promise.resolve(null)){let t=null,r=null,a=()=>{let e={name:"Error",message:""};if("captureStackTrace"in Error)Error.captureStackTrace(e,a),t=e;else try{throw Error("")}catch(r){t=r}};a();let s=c.$$sync;null!==s&&"object"==typeof s&&"function"==typeof s.addToWait&&s.addToWait(e.name);try{r=e()}catch(u){r=u}return{get getResult(){if(i(r))return{asA:{get promise(){return console.warn(`'${e.name}(...)' did not return a promise`),r.__name=e.name,Promise.resolve(r)},get value(){if(n(r)){let l=Error(`'${e.name}(...)' did not return a valid value`);throw l.cause=r.valueOf(),l}return r}},orThrow(a){if(n(r)){let s=Promise.reject(r.valueOf());return s.__name=e.name,new o(s,a,c.$$sync,e.name,t)}let i=Promise.resolve(r);return i.__name=e.name,new o(i,a,c.$$sync,e.name,t)}};return{asA:{get promise(){return r.__name=e.name,r},get value(){throw Error(`'${e.name}(...)' returned a promise`)}},orThrow:n=>(r.__name=e.name,new o(r,n,c.$$sync,e.name,t))}}}}e.runn=c});
